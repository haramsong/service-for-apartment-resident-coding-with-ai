# 프로필 아바타 업로드 기능 구현

_작성일: 2025-11-05_

_작성자: Developer Agent_

## 구현 내용

### 1. 데이터베이스 스키마 변경
- User 모델에 `avatar` 필드 추가 (VARCHAR(500), nullable)
- Prisma 마이그레이션 생성 및 적용

### 2. API 구현
- **파일 업로드 API**: `/api/upload` (POST)
  - NextAuth 세션 인증 필수
  - 파일을 `public/uploads/` 디렉토리에 저장
  - 타임스탬프 기반 고유 파일명 생성
  
- **아바타 업데이트 API**: `user.updateAvatar` (tRPC)
  - 업로드된 이미지 URL을 데이터베이스에 저장
  - 인증된 사용자만 자신의 아바타 업데이트 가능

### 3. UI 구현
- MY 페이지에 아바타 업로드 기능 추가
- 카메라 아이콘 버튼으로 파일 선택 트리거
- 업로드 중 로딩 상태 표시
- 업로드 완료 후 세션 자동 업데이트

### 4. 타입 정의
- NextAuth 타입에 `avatar` 필드 추가
- Session, User, JWT 인터페이스 확장

### 5. 인증 시스템 통합
- JWT 토큰에 avatar 정보 포함
- 세션 콜백에서 avatar 전달
- authorize 함수에서 avatar 반환

## 기술적 세부사항

### 파일 저장 방식
- 로컬 파일 시스템 (`public/uploads/`)
- 파일명 형식: `{timestamp}-{original-filename}`
- 공개 URL: `/uploads/{filename}`

### 보안 고려사항
- NextAuth 세션 검증으로 인증된 사용자만 업로드 가능
- 파일 타입 제한 (image/*)
- 파일 크기 제한은 추후 추가 필요

## 환경 설정 변경
- `.env` 파일에 `DIRECT_URL` 환경변수 추가
- Prisma 마이그레이션 실행을 위해 필요

## 다음 단계 개선 사항
1. 파일 크기 제한 추가 (예: 5MB)
2. 이미지 리사이징 (최적화)
3. S3 등 클라우드 스토리지 연동
4. 이전 아바타 파일 삭제 로직
5. 에러 처리 개선 (사용자 피드백)

## 테스트 방법
1. MY 페이지 접속
2. 프로필 아바타의 카메라 아이콘 클릭
3. 이미지 파일 선택
4. 업로드 완료 후 아바타 이미지 표시 확인
